---
title: "Branch Protection"
description: An overview of the integration between OpenShift CI and GitHub branch protection.
---
## What Is Branch Protection?

Branch protection is a repository setting that enforces certain rules when trying to merge to a protected branch. See
the [GitHub documentation](https://docs.github.com/en/free-pro-team@latest/github/administering-a-repository/about-protected-branches)
for more details.

## What Do We Use It For?

We use it to enforce that mandatory jobs succeed before allowing a merge. These jobs are marked as `Required` in their GitHub
status context. Sample:
![Required Status context](/branchprotection_sample_required_job.png)


If you open a new Pull Request to a branch that has required jobs, these jobs will initially be marked as
`Required - Context Expected`. Sample:
![Required absent Status context](/branchprotection_sample_required_job_status_expected.png)

This status is generated by GitHub and means that Prow didn't report the job as running yet.

Additionally, the branch protection settings are interpreted by the merge automation
[`tide`](https://github.com/kubernetes/test-infra/blob/master/prow/cmd/tide/README.md) in order to [determine if jobs that
are not managed by Prow should be considered merge
blocking.](https://github.com/kubernetes/test-infra/blob/master/prow/jobs.md#requiring-jobs-for-auto-merge-through-tide)

## How Do We Set up Branch Protection?

Branch Protection requires no manual set-up for repositories with presubmit jobs. When a mandatory presubmit job is
added or removed from a repository, automation will ensure that the GitHub Branch Protection settings are updated as
well.

Branch protection is configured by a job that runs periodically every six hours. You can see
[here](https://prow.ci.openshift.org/?job=periodic-branch-protector) when it last ran. The implication of this is that
when you add/remove a mandatory job, it may take up to six hours for this change to show up in GitHub.

The `openshift-merge-robot` that configures the branch protection needs admin permissions.

## Is It Possible to Disable the Branch Protection for My Repository or Require Jobs That Are Not Managed by Prow?

Yes, these settings are configured [in the Prow
config.](https://github.com/openshift/release/blob/master/core-services/prow/02_config/_config.yaml)

The basic structure looks like this:

{{< highlight yaml >}}
branch-protection:
  orgs:
    << org >>:
      repos:
        << repo >>:
          # Protect all branches
          protect: true
          # This external check must pass before merging is allowed
          required_status_checks:
            contexts:
            - my-other-ci-system
          branches:
            << branch >>:
              # Do not protect this branch. This setting can be set
              # for the org, repo or branch. Set it at the highest level
              # that makes sense. Lower levels can not override it.
              unmanaged: true
{{< / highlight >}}

An overview of all available settings and a more detailled explanation can be found in the
[upstream documentation.](https://github.com/kubernetes/test-infra/blob/master/prow/cmd/branchprotector/README.md)

If your goal is to not have Prow manage the branch protection, please use `unmanaged: true`.

If your goal is to disable the branch protection, i.e., deleting the branch protection setting on GitHub if existing, please use `protect: false`. 
Thus, the `openshift-merge-robot` account needs the admin permissions that are necessary for this operation


| Required jobs | `protect:` stanza  | What `branchprotector` does  | Requires admin |
|---|---|---|---|
| yes | absent | Enforces BP for required jobs | yes |
| yes | `true` | Enforces BP for required jobs | yes |
| yes | `false` | Enforces BP is disabled | yes |
| no | absent | Does not touch BP settings | no |
| no | `true` | Enforces BP defined by the configuration | yes |
| no | `false` | Enforces BP is disabled | yes |
